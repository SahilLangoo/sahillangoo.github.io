---
import MainLayout from '../../layouts/MainLayout.astro'
import { getCollection } from 'astro:content'
import FormattedDate from '../../components/FormattedDate.astro'

// Filter out content entries with draft: true
const publishedBlogEntries = await getCollection('blog', ({ data }) => {
	return data.draft !== true
})

const posts = publishedBlogEntries.sort(
	(a, b) => a.data.pubDate.valueOf() - b.data.pubDate.valueOf(),
)
---

<MainLayout>
	<h1 class="text-2xl md:text-4xl font-bold mb-4 text-center font-primary">sl [infinity] blog [✒️].</h1>
	<p class="text-lg text-center mb-8 font-secondary">My thoughts here, I write about random stuff, tech, and life in general.
		<br/><a href="https://twitter.com/kashurgeek" target="_blank" class="text-primary">Follow me on twitter</a> to get notified when I post something new.
		<br/> showing [{posts.length}] posts.
	</p>
	<main>
		<section class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 gap-4 mx-8">
			{
				posts.map((post) => (
						<a href={`/blog/${post.slug}/`}>
							<div class='card card-compact w-full bg-base-500 shadow-xl border-2 border-primary'>
								<figure>
									<img
										src={post.data.heroImage}
										alt='{post.data.heroImage}'
									/>
								</figure>
								<div class='card-body'>
									<h2 class='card-title font-primary'>{post.data.title}</h2>
									<FormattedDate date={post.data.pubDate} />
									<p class="font-secondary">{post.data.description}</p>
									<div class='card-actions justify-end'>
										{
											post.data.tags && post.data.tags.map(tag => (
												<div class='badge badge-outline'>{tag}</div>
											))
										}
									</div>
								</div>
							</div>
						</a>
				))
			}
		</section>
	</main>
</MainLayout>
